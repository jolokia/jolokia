<!DOCTYPE html>
<!-- Generated by Apache Maven Doxia at 2024-12-04 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="keywords" content="jmx, rest, json, http, agent, jmx-rest-bridge, java, jmx4perl, jsr-160, jmx-rest">
  <title>                              Jolokia &#x2013; Bulk Requests                                </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap">
  <style media="all">
    @import url("../css/reset.css");
    @import url("../css/text.css");
    @import url("../css/maven-theme-jolokia.css");
    @import url("../css/site.css");
  </style>
  <script data-cfasync="false">
    let host = "jolokia.org";
      if ((host === window.location.host) && (window.location.protocol !== "https:")) {
        window.location.protocol = "https";
      }
  </script>
  <script src="../js/prettify/prettify.js"></script>
  <link rel="stylesheet" href="../css/print.css" media="print">
  <link rel="icon" type="image/png" href="../images/favicon.png">
  <meta name="Date-Creation-yyyymmdd" content="20241204" />
  <meta name="Date-Revision-yyyymmdd" content="20241204" />
  <meta http-equiv="Content-Language" content="en" />
  
</head>
<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="header-image"></div>
  </div>

  <!-- Top-Bar  -->
  <nav class="header">
      <div class="top_left"></div>
      <div class="top_link">
        <a href="../index.html">Home</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../download.html">Download</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../features.html">Features</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../documentation.html">Documentation</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../support.html">Support</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="https://ro14nd.de">Blog</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../about.html">About</a>
    </div>
    <div class="top_sep"></div>
    </nav>

  <main>
    <nav class="menu">
            <div class="navibox">
          <div class="navihead">
             <h5>Jolokia</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../libraries.html" title="Libraries">Libraries</a>
            </li>
                  <li class="none">
                          <a href="../migration.html" title="Migration to 2.0">Migration to 2.0</a>
            </li>
                  <li class="none">
                          <a href="../features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="../support.html" title="Support">Support</a>
            </li>
                  <li class="none">
                          <a href="../license.html" title="License">License</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../documentation.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../concepts.html" title="Concepts">Concepts</a>
            </li>
                  <li class="none">
                          <a href="../tutorial.html" title="Tutorial">Tutorial</a>
            </li>
                  <li class="none">
                          <a href="../reference/html/index.html" title="Reference Manual">Reference Manual</a>
            </li>
                  <li class="none">
                          <a href="../talks.html" title="Talks and Screencasts">Talks and Screencasts</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Agents</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../agent.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../agent/war.html" title="Web Archive (war)">Web Archive (war)</a>
            </li>
                  <li class="none">
                          <a href="../agent/osgi.html" title="Osgi">Osgi</a>
            </li>
                  <li class="none">
                          <a href="../agent/jvm.html" title="JVM">JVM</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Clients</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../client/java.html" title="Java">Java</a>
            </li>
                  <li class="none">
                          <a href="../client/javascript.html" title="JavaScript">JavaScript</a>
            </li>
                  <li class="none">
                          <a href="../client/perl.html" title="Perl">Perl</a>
            </li>
                  <li class="none">
                          <a href="../client/curl.html" title="Curl">Curl</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Project Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
    </div>
      </div>
      </nav>
    <div class="main">
      <!-- Page content -->
      <div class="sect1">
<h2 id="bulk_requests">Bulk Requests</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image right"><img src="../images/features/bulk_requests_large.png" alt="Bulk-Requests"/></span>
In order to monitor Java application servers, a multitude of
parameters can be observed. Memory and thread consumption,
database connection pool utilisation, HTTP request response
for various web application are examples for valuable metrics
to monitor. Typically, 10-20 monitored attributes are a good
setup for a single Jakarta EE server.</p>
</div>
<div class="paragraph">
<p>With the traditional approach using JSR-160 JMX connectors,
a connection is opened, and for each attribute queried a
separate RMI (or optional JMXMP) request needs to be send to
the server resulting in several client-server turnarounds.
Wouldn&#8217;t it be nice to use a single request for querying all
those parameters?</p>
</div>
<div class="paragraph">
<p>With Jolokia&#8217;s <strong>bulk requests</strong> this is a piece
of cake. A single HTTP POST request can carry a list of JSON
request objects, which are dispatched by the Jolokia agent on
the server side into multiple local JMX calls. The results are
collected and returned as list of JSON response objects. In
case of an exception when executing the JMX call, the error is
propragated as part of the response without influencing the
other results.</p>
</div>
<div class="sect2">
<h3 id="example">Example</h3>
<div class="paragraph">
<p>Let&#8217;s have a look at an example. Jolokia client libraries
(currently available for <a href="../client/javascript.html">JavaScript</a>,
<a href="../client/java.html">Java</a> and
<a href="../client/perl.html">Perl</a>) make the usage of bulk
request easy by providing an extra layer of abstraction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="nc">J4pClient</span> <span class="n">j4pClient</span> <span class="o">=</span> <span class="nc">J4pClient</span><span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">"http://localhost:8080/jolokia"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">user</span><span class="o">(</span><span class="s">"jolokia"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"jolokia"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">J4pReadRequest</span> <span class="n">req1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">J4pReadRequest</span><span class="o">(</span><span class="s">"java.lang:type=Memory"</span><span class="o">,</span> <span class="s">"HeapMemoryUsage"</span><span class="o">);</span>
<span class="nc">J4pExecRequest</span> <span class="n">req2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">J4pExecRequest</span><span class="o">(</span><span class="s">"java.lang:type=Memory"</span><span class="o">,</span> <span class="s">"gc"</span><span class="o">);</span>
<span class="nc">J4pReadRequest</span> <span class="n">req3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">J4pReadRequest</span><span class="o">(</span><span class="s">"java.lang:type=Memory"</span><span class="o">,</span> <span class="s">"HeapMemoryUsage"</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">J4pResponse</span><span class="o">&lt;</span><span class="nc">J4pRequest</span><span class="o">&gt;&gt;</span> <span class="n">responses</span> <span class="o">=</span> <span class="n">j4pClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">req1</span><span class="o">,</span> <span class="n">req2</span><span class="o">,</span> <span class="n">req3</span><span class="o">);</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">responses</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">responses</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Memory usage before gc(): used: "</span> <span class="o">+</span> <span class="n">m1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"used"</span><span class="o">)</span>
        <span class="o">+</span> <span class="s">" / max: "</span> <span class="o">+</span> <span class="n">m1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"max"</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Memory usage after gc(): used: "</span> <span class="o">+</span> <span class="n">m2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"used"</span><span class="o">)</span>
        <span class="o">+</span> <span class="s">" / max: "</span> <span class="o">+</span> <span class="n">m2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"max"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This gets translated in the following JSON request, which is
transmitted to the agent via an HTTP POST request (the URL has
been set up in the <code>j4pClient</code> object above):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"mbean"</span><span class="p">:</span><span class="s2">"java.lang:type=Memory"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"attribute"</span><span class="p">:</span><span class="s2">"HeapMemoryUsage"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"read"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"operation"</span><span class="p">:</span><span class="s2">"gc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"mbean"</span><span class="p">:</span><span class="s2">"java.lang:type=Memory"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"exec"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"mbean"</span><span class="p">:</span><span class="s2">"java.lang:type=Memory"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"attribute"</span><span class="p">:</span><span class="s2">"HeapMemoryUsage"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"read"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The answer returned is also represented in JSON and looks like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"mbean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"java.lang:type=Memory"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HeapMemoryUsage"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"read"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"init"</span><span class="p">:</span><span class="w"> </span><span class="mi">524288000</span><span class="p">,</span><span class="w">
      </span><span class="nl">"committed"</span><span class="p">:</span><span class="w"> </span><span class="mi">71303168</span><span class="p">,</span><span class="w">
      </span><span class="nl">"max"</span><span class="p">:</span><span class="w"> </span><span class="mi">8334082048</span><span class="p">,</span><span class="w">
      </span><span class="nl">"used"</span><span class="p">:</span><span class="w"> </span><span class="mi">13881840</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1701935299</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"mbean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"java.lang:type=Memory"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"exec"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"operation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gc"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1701935300</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"mbean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"java.lang:type=Memory"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HeapMemoryUsage"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"read"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"init"</span><span class="p">:</span><span class="w"> </span><span class="mi">524288000</span><span class="p">,</span><span class="w">
      </span><span class="nl">"committed"</span><span class="p">:</span><span class="w"> </span><span class="mi">71303168</span><span class="p">,</span><span class="w">
      </span><span class="nl">"max"</span><span class="p">:</span><span class="w"> </span><span class="mi">8334082048</span><span class="p">,</span><span class="w">
      </span><span class="nl">"used"</span><span class="p">:</span><span class="w"> </span><span class="mi">13842720</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1701935300</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example how bulk requests can be used is the
<a href="https://www.nagios.org/" class="externalLink" target="<em>blank">Nagios</a>
Plugin
<a href="https://metacpan.org/dist/jmx4perl/view/scripts/check_jmx4perl" class="externalLink" target="_blank" rel="noopener">check_jmx4perl</a>,
which uses bulk requests
for its _multi check</em> features, which allows for a
single Nagios check monitor as many JMX attributes and
operations as required.</p>
</div>
</div>
<div class="sect2">
<h3 id="next">Next</h3>
<div class="ulist">
<ul>
<li>
<p>Learn more about Jolokia&#8217;s <a href="proxy.html">Proxy Mode</a> and agentless operation.</p>
</li>
<li>
<p>Read an introduction and <a href="overview.html">overview</a> for Jolokia.</p>
</li>
<li>
<p>Go Back to the <a href="../features.html">Features Overview</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
      <!-- /Page content -->
    </div>
  </main>

  <footer class="copyright">Copyright &#169;                   2024 Roland Hu&szlig;. 
          All Rights Reserved.      
                
                 <span id="publishDate">Last Published: 2024-12-04</span>
              &nbsp;| <span id="projectVersion">Version: 2.1.3-SNAPSHOT</span>
            </footer>
</div>
</body>
</html>
