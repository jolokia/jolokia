<!DOCTYPE html>
<!-- Generated by Apache Maven Doxia at 2024-12-04 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="keywords" content="jmx, rest, json, http, agent, jmx-rest-bridge, java, jmx4perl, jsr-160, jmx-rest">
  <title>                                        Jolokia &#x2013; JMX Proxy                      </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap">
  <style media="all">
    @import url("../css/reset.css");
    @import url("../css/text.css");
    @import url("../css/maven-theme-jolokia.css");
    @import url("../css/site.css");
  </style>
  <script data-cfasync="false">
    let host = "jolokia.org";
      if ((host === window.location.host) && (window.location.protocol !== "https:")) {
        window.location.protocol = "https";
      }
  </script>
  <script src="../js/prettify/prettify.js"></script>
  <link rel="stylesheet" href="../css/print.css" media="print">
  <link rel="icon" type="image/png" href="../images/favicon.png">
  <meta name="Date-Creation-yyyymmdd" content="20241204" />
  <meta name="Date-Revision-yyyymmdd" content="20241204" />
  <meta http-equiv="Content-Language" content="en" />
  
</head>
<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="header-image"></div>
  </div>

  <!-- Top-Bar  -->
  <nav class="header">
      <div class="top_left"></div>
      <div class="top_link">
        <a href="../index.html">Home</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../download.html">Download</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../features.html">Features</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../documentation.html">Documentation</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../support.html">Support</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="https://ro14nd.de">Blog</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../about.html">About</a>
    </div>
    <div class="top_sep"></div>
    </nav>

  <main>
    <nav class="menu">
            <div class="navibox">
          <div class="navihead">
             <h5>Jolokia</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../libraries.html" title="Libraries">Libraries</a>
            </li>
                  <li class="none">
                          <a href="../migration.html" title="Migration to 2.0">Migration to 2.0</a>
            </li>
                  <li class="none">
                          <a href="../features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="../support.html" title="Support">Support</a>
            </li>
                  <li class="none">
                          <a href="../license.html" title="License">License</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../documentation.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../concepts.html" title="Concepts">Concepts</a>
            </li>
                  <li class="none">
                          <a href="../tutorial.html" title="Tutorial">Tutorial</a>
            </li>
                  <li class="none">
                          <a href="../reference/html/index.html" title="Reference Manual">Reference Manual</a>
            </li>
                  <li class="none">
                          <a href="../talks.html" title="Talks and Screencasts">Talks and Screencasts</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Agents</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../agent.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../agent/war.html" title="Web Archive (war)">Web Archive (war)</a>
            </li>
                  <li class="none">
                          <a href="../agent/osgi.html" title="Osgi">Osgi</a>
            </li>
                  <li class="none">
                          <a href="../agent/jvm.html" title="JVM">JVM</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Clients</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../client/java.html" title="Java">Java</a>
            </li>
                  <li class="none">
                          <a href="../client/javascript.html" title="JavaScript">JavaScript</a>
            </li>
                  <li class="none">
                          <a href="../client/perl.html" title="Perl">Perl</a>
            </li>
                  <li class="none">
                          <a href="../client/curl.html" title="Curl">Curl</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Project Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
    </div>
      </div>
      </nav>
    <div class="main">
      <!-- Page content -->
      <div class="sect1">
<h2 id="jmx_proxy">JMX Proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image right"><img src="../images/features/proxy_large.png" alt="JMX Proxy"/></span>
There are situations, where a deployment of an Jolokia agent
on the target platform is not possible. This might be for
political reasons or an already established JSR-160 export on
the instrumented servers. In these environments, Jolokia can
operate as a <strong>JMX Proxy</strong>. In this setup, the
agent is deployed on a dedicated proxy Jakarta EE server (or other
supported agent platform). The proxy bridges between Jolokia
JSON request and responses to remote JSR-160 calls to the
target server. The following diagrams gives an illustration of
this setup.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/jolokia_proxy.png" alt="Proxy Mode"/>
</div>
</div>
<div class="paragraph">
<p>A Jolokia proxy is universal and agnostic to the target server
as it gets its information for the target via an incoming
request (the same as for an HTTP proxy). Due to this required
extended information, only Jolokia POST requests can be used
for proxying since there is currently no way to encapsulate
the target information within a GET URL. The base Jolokia URL
for the request is that of the proxy server, whereas the
target parameters are included in the request.</p>
</div>
<div class="sect2">
<h3 id="jmx_remote_primer">JMX Remote primer</h3>
<div class="paragraph">
<p>The standard (but often forgotten) <em>remoting</em> technology for Java applications is RMI.</p>
</div>
<div class="paragraph">
<p>In order to access a <code>javax.management.MBeanServer</code> available withing a remote JVM, we should actually
access a <em>remote view</em> of this interface. It is possible using <a href="https://docs.oracle.com/en/java/javase/11/management/monitoring-and-management-using-jmx-technology.html#GUID-F08985BB-629A-4FBF-A0CB-8762DF7590E0" class="externalLink" target="_blank" rel="noopener">Remote Monitoring and Management</a>.</p>
</div>
<div class="paragraph">
<p>The connection is established between two entities specified in "Chapter 13, Connectors" of the unified JMX specification (combined JSR-3 and JSR-160):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>connector server</em> - it is attached to target <code>javax.management.MBeanServer</code> within the same JVM and listens for incoming messages using some kind of protocol.</p>
</li>
<li>
<p><em>connector client</em> - it is used to find and connect to running <em>connector server</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JMX specification defines two protocols to be used between <em>connector client</em> and <em>connector server</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jmxrmi</code> - a protocol based on RMI (mandatory protocol for JMX implementations), uses JMX URIs in the form of <code>service:jmx:rmi://&#8230;&#8203;</code></p>
</li>
<li>
<p><code>jmxmp</code> - a protocol based directly on TCP sockets (optional protocol), uses JMX URIs in the form of <code>service:jmx:jmxmp://&#8230;&#8203;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Java method to create and start <em>connector server</em> is <code>javax.management.remote.JMXConnectorServerFactory.newJMXConnectorServer()</code> and there&#8217;s only one standard implementation - <code>javax.management.remote.rmi.RMIConnectorServer</code> which supports RMI protocol and <code>service:jmx:rmi://&#8230;&#8203;</code> JMX URIs</p>
</div>
<div class="paragraph">
<p>For RMI protocol, these JMX URIs are supported when creating a <em>connector server</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>service:jmx:rmi://host:port</code> or <code>service:jmx:rmi://host:port/</code> - after starting the <em>connector server</em>, a <code>java.rmi.Remote</code> object representing this server will be Base64 encoded and client will be able to access such server using <code>service:jmx:rmi://host:port/stub/&lt;base64 encoded javax.management.remote.rmi.RMIServer stub&gt;</code></p>
</li>
<li>
<p><code>service:jmx:rmi://host:port/jndi/&lt;path&gt;</code> - after starting the <em>connector server</em>, its RMI stub will be bound in JNDI registry under <code>&lt;path&gt;</code> name. The <code>&lt;path&gt;</code> is usually complex name in the form of <code>rmi://rmi-registry-host:port/name</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Knowing the above, the typical JMX URI of the remote MBean Server is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>jmxrmi</code> is a name explicitly used by <code>sun.management.jmxremote.ConnectorBootstrap.exportMBeanServer()</code> and the first <code>host:port</code> part are omitted becase we only care about the RMI registry where <code>javax.management.remote.rmi.RMIServer</code> is bound.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this technology, what JVM actually <em>exposes</em> as a remote view of <code>javax.management.remote.rmi.RMIServer</code> interface which can be used to obtain <code>javax.management.remote.rmi.RMIConnection</code> interface which finally can be used to get/set MBean attributes, call MBean operations, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="proxy_connection_to_remote_jmx_server">Proxy connection to Remote JMX server</h3>
<div class="paragraph">
<p>In the next
example, a proxied Jolokia request queries the number of
active threads for a Tomcat server via a proxy
<code>jolokia-proxy</code>, which has an agent deployed under
the context <code>jolokia</code>. The agent URL then is
something like</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://jolokia-proxy:8080/jolokia</pre>
</div>
</div>
<div class="paragraph">
<p>and the POST payload of the request is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"read"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"mbean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Catalina:type=Server"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"serverInfo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"user"</span><span class="p">:</span><span class="s2">"s!cr!t"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"read"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"mbean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"java.lang:type=Threading"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ThreadCount"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"user"</span><span class="p">:</span><span class="s2">"s!cr!t"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The target is part of the request and can contain
authentication information as well (with params
<code>user</code> and <code>password</code>)</p>
</div>
<div class="paragraph">
<p>The result may look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"mbean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Catalina:type=Server"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"targetId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"user"</span><span class="p">:</span><span class="s2">"s!cr!t"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"serverInfo"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"read"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apache Tomcat/10.1.16"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1701952860</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"mbean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"java.lang:type=Threading"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"targetId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"user"</span><span class="p">:</span><span class="s2">"s!cr!t"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"attribute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ThreadCount"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"read"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1701952860</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="limitations">Limitations</h3>
<div class="paragraph">
<p>Operating Jolokia as a JMX proxy has some limitations
compared to a native agent deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="bulk-requests.html">Bulk requests</a> are
possible but not as efficient as for direct operation. The
reason is, that JSR-160 remoting doesn&#8217;t know about bulk
requests, so that a Jolokia bulk request arriving at the
proxy gets dispatched into multiple JSR-160 requests for the
target. The JSR-160 remote connection has to be
established only once, though.</p>
</li>
<li>
<p>The JMX target URL addresses the MBeanServer directly, so
MBeanServer merging as it happens for direct operation is
not available. Also, certain workarounds for bugs in the
server&#8217;s JMX implementation are not available.</p>
</li>
<li>
<p>When not standard Java types are returned by JMX operations
or attribute read calls, these types must be available on
the proxy, too. Using the Jolokia agent directly, complex
data types are serialized deeply into a JSON
representation automatically.</p>
</li>
<li>
<p>For each Jolokia request, a new JMX connection (likely
using RMI) is created which is an expensive operation. A
future version of Jolokia will tackle this by providing
some sort of optional JSR-160 connection pooling.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="next">Next</h3>
<div class="ulist">
<ul>
<li>
<p>See why how Jolokia can <a href="security.html">secure</a> JMX access in a very fine granular way.</p>
</li>
<li>
<p>Learn something about <a href="bulk-requests.html">bulk JMX requests</a>.</p>
</li>
<li>
<p>Go Back to the <a href="../features.html">Features Overview</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
      <!-- /Page content -->
    </div>
  </main>

  <footer class="copyright">Copyright &#169;                   2024 Roland Hu&szlig;. 
          All Rights Reserved.      
                
                 <span id="publishDate">Last Published: 2024-12-04</span>
              &nbsp;| <span id="projectVersion">Version: 2.1.3-SNAPSHOT</span>
            </footer>
</div>
</body>
</html>
