<!DOCTYPE html>
<!-- Generated by Apache Maven Doxia at 2024-12-04 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="keywords" content="jmx, rest, json, http, agent, jmx-rest-bridge, java, jmx4perl, jsr-160, jmx-rest">
  <title>                                      Jolokia &#x2013; Polyglot                        </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap">
  <style media="all">
    @import url("../css/reset.css");
    @import url("../css/text.css");
    @import url("../css/maven-theme-jolokia.css");
    @import url("../css/site.css");
  </style>
  <script data-cfasync="false">
    let host = "jolokia.org";
      if ((host === window.location.host) && (window.location.protocol !== "https:")) {
        window.location.protocol = "https";
      }
  </script>
  <script src="../js/prettify/prettify.js"></script>
  <link rel="stylesheet" href="../css/print.css" media="print">
  <link rel="icon" type="image/png" href="../images/favicon.png">
  <meta name="Date-Creation-yyyymmdd" content="20241204" />
  <meta name="Date-Revision-yyyymmdd" content="20241204" />
  <meta http-equiv="Content-Language" content="en" />
  
</head>
<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="header-image"></div>
  </div>

  <!-- Top-Bar  -->
  <nav class="header">
      <div class="top_left"></div>
      <div class="top_link">
        <a href="../index.html">Home</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../download.html">Download</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../features.html">Features</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../documentation.html">Documentation</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../support.html">Support</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="https://ro14nd.de">Blog</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../about.html">About</a>
    </div>
    <div class="top_sep"></div>
    </nav>

  <main>
    <nav class="menu">
            <div class="navibox">
          <div class="navihead">
             <h5>Jolokia</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../libraries.html" title="Libraries">Libraries</a>
            </li>
                  <li class="none">
                          <a href="../migration.html" title="Migration to 2.0">Migration to 2.0</a>
            </li>
                  <li class="none">
                          <a href="../features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="../support.html" title="Support">Support</a>
            </li>
                  <li class="none">
                          <a href="../license.html" title="License">License</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../documentation.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../concepts.html" title="Concepts">Concepts</a>
            </li>
                  <li class="none">
                          <a href="../tutorial.html" title="Tutorial">Tutorial</a>
            </li>
                  <li class="none">
                          <a href="../reference/html/index.html" title="Reference Manual">Reference Manual</a>
            </li>
                  <li class="none">
                          <a href="../talks.html" title="Talks and Screencasts">Talks and Screencasts</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Agents</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../agent.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../agent/war.html" title="Web Archive (war)">Web Archive (war)</a>
            </li>
                  <li class="none">
                          <a href="../agent/osgi.html" title="Osgi">Osgi</a>
            </li>
                  <li class="none">
                          <a href="../agent/jvm.html" title="JVM">JVM</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Clients</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../client/java.html" title="Java">Java</a>
            </li>
                  <li class="none">
                          <a href="../client/javascript.html" title="JavaScript">JavaScript</a>
            </li>
                  <li class="none">
                          <a href="../client/perl.html" title="Perl">Perl</a>
            </li>
                  <li class="none">
                          <a href="../client/curl.html" title="Curl">Curl</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Project Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
    </div>
      </div>
      </nav>
    <div class="main">
      <!-- Page content -->
      <div class="sect1">
<h2 id="polyglot">Polyglot</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image right"><img src="../images/features/polyglot_large.png" alt="Polyglot"/></span>
The next examples demonstrate the usage of Jolokia with
various different clients. The samples check for memory and
performs some action if the used heap memory exceeds a certain
threshold. No error handling was included in order to focus on
the Jolokia logic.</p>
</div>
<div class="sect2">
<h3 id="bash">Bash</h3>
<div class="paragraph">
<p>Jolokia can be contacted without any client library directly
from a Bash script. This example checks, that the Memory used doesn&#8217;t
exceeds 90% of the available memory, and if so, restarts the
Tomcat server (without any error handling, though):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="nv">base_url</span><span class="o">=</span><span class="s2">"http://localhost:8080/jolokia"</span>
<span class="nv">memory_url</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">base_url</span><span class="k">}</span><span class="s2">/read/java.lang:type=Memory/HeapMemoryUsage"</span>
<span class="nv">used</span><span class="o">=</span><span class="sb">`</span>curl <span class="nt">-u</span> jolokia:jolokia <span class="nt">-H</span><span class="s1">'Content-Type: application/json'</span> <span class="nt">-s</span> <span class="s2">"</span><span class="k">${</span><span class="nv">memory_url</span><span class="k">}</span><span class="s2">/used"</span> | jq .value<span class="sb">`</span>
<span class="nv">max</span><span class="o">=</span><span class="sb">`</span>curl <span class="nt">-u</span> jolokia:jolokia <span class="nt">-H</span><span class="s1">'Content-Type: application/json'</span> <span class="nt">-s</span> <span class="s2">"</span><span class="k">${</span><span class="nv">memory_url</span><span class="k">}</span><span class="s2">/max"</span> | jq .value<span class="sb">`</span>
<span class="nv">usage</span><span class="o">=</span><span class="k">$((${</span><span class="nv">used</span><span class="k">}</span><span class="o">*</span><span class="m">100</span><span class="o">/</span><span class="k">${</span><span class="nv">max</span><span class="k">}))</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$usage</span> <span class="nt">-gt</span> 90 <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="k">${</span><span class="nv">TC</span><span class="k">}</span>/bin/catalina.sh stop 10
  <span class="k">${</span><span class="nv">TC</span><span class="k">}</span>/bin/catalina.sh start
<span class="k">fi</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="perl">Perl</h3>
<div class="paragraph">
<p>Using the <a href="https://metacpan.org/dist/jmx4perl" class="externalLink" target="_blank" rel="noopener">jmx4perl</a>
client library, this can be done even simpler in Perl (and in
this case with a single HTTP request):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/usr/bin/perl</span>
use JMX::Jmx4Perl<span class="p">;</span>
use strict<span class="p">;</span>
my <span class="nv">$jmx</span> <span class="o">=</span> new JMX::Jmx4Perl<span class="o">(</span>url <span class="o">=&gt;</span> <span class="s2">"http://localhost:8080/jolokia"</span>
                            user <span class="o">=&gt;</span> <span class="s2">"jolokia"</span>, password <span class="o">=&gt;</span> <span class="s2">"jolokia"</span><span class="o">)</span><span class="p">;</span>
my <span class="nv">$memory</span> <span class="o">=</span> <span class="nv">$jmx</span>-&gt;get_attribute<span class="o">(</span><span class="s2">"java.lang:type=Memory"</span>, <span class="s2">"HeapMemoryUsage"</span><span class="o">)</span><span class="p">;</span>
<span class="k">if</span> <span class="o">(</span><span class="nv">$memory</span>-&gt;<span class="o">{</span><span class="s2">"used"</span><span class="o">}</span> / <span class="nv">$memory</span>-&gt;<span class="o">{</span><span class="s2">"max"</span><span class="o">}</span> <span class="o">&gt;</span> 0.9<span class="o">)</span> <span class="o">{</span>
    system<span class="o">(</span><span class="s2">"</span><span class="k">${</span><span class="nv">TC</span><span class="k">}</span><span class="s2">/bin/catalina.sh stop 10"</span><span class="o">)</span><span class="p">;</span>
    system<span class="o">(</span><span class="s2">"</span><span class="k">${</span><span class="nv">TC</span><span class="k">}</span><span class="s2">/bin/catalina.sh start"</span><span class="o">)</span><span class="p">;</span>
    <span class="nb">sleep</span><span class="o">(</span>120<span class="o">)</span><span class="p">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="javascript">JavaScript</h3>
<div class="paragraph">
<p>The JSON based Jolokia protocol fits perfectly in the
JavaScript world. Jolokia provides a
<a href="../client/javascript.html">JavaScript client
library</a> which makes it a piece of cake to access JMX
information directly from within the browser. A variant of
the memory example above looks in JavaScript like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">var</span> <span class="nx">j4p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Jolokia</span><span class="p">(</span><span class="dl">"</span><span class="s2">/jolokia</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">j4p</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">read</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">mbean</span><span class="p">:</span> <span class="dl">"</span><span class="s2">java.lang:type=Memory</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">attribute</span><span class="p">:</span> <span class="dl">"</span><span class="s2">HeapMemoryUsage</span><span class="dl">"</span>
<span class="p">},{</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="dl">"</span><span class="s2">used</span><span class="dl">"</span><span class="p">]</span> <span class="o">/</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="dl">"</span><span class="s2">max</span><span class="dl">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Memory exceeds 90% threshold</span><span class="dl">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java">Java</h3>
<div class="paragraph">
<p>The Jolokia agents can be accessed from Java as well. The
biggest different to JSR-160 client interfaces is, that
Jolokia has a typeless approach. The disadvantage is of
course, that the type of the exposed
attribute or operation return value has to be known, but the
big advantage is, that no Java type information for custom
types (== custom Java classes) is required on the client
side.</p>
</div>
<div class="paragraph">
<p>The example above implemented in Java looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="kn">import</span> <span class="nn">org.jolokia.client.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jolokia.client.request.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JolokiaSample</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">J4pClient</span> <span class="n">j4pClient</span> <span class="o">=</span> <span class="nc">J4pClient</span><span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="s">"http://localhost:8080/jolokia"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">user</span><span class="o">(</span><span class="s">"jolokia"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"jolokia"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">J4pReadRequest</span> <span class="n">req</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">J4pReadRequest</span><span class="o">(</span><span class="s">"java.lang:type=Memory"</span><span class="o">,</span>
                <span class="s">"HeapMemoryUsage"</span><span class="o">);</span>
        <span class="nc">J4pReadResponse</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">j4pClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">used</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="n">vals</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"used"</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">max</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="n">vals</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"max"</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">usage</span> <span class="o">=</span> <span class="n">used</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">max</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">usage</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Memory usage exceeds 90% (used: "</span> <span class="o">+</span> <span class="n">used</span> <span class="o">+</span>
                    <span class="s">" / max: "</span> <span class="o">+</span> <span class="n">max</span> <span class="o">+</span> <span class="s">" = "</span> <span class="o">+</span> <span class="n">usage</span> <span class="o">+</span> <span class="s">"%)"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="next">Next</h3>
<div class="ulist">
<ul>
<li>
<p>Read an introduction and <a href="overview.html">overview</a> for Jolokia.</p>
</li>
<li>
<p>See why Jolokia plays nicely with your <a href="firewall.html">firewall</a>.</p>
</li>
<li>
<p>Go Back to the <a href="../features.html">Features Overview</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
      <!-- /Page content -->
    </div>
  </main>

  <footer class="copyright">Copyright &#169;                   2024 Roland Hu&szlig;. 
          All Rights Reserved.      
                
                 <span id="publishDate">Last Published: 2024-12-04</span>
              &nbsp;| <span id="projectVersion">Version: 2.1.3-SNAPSHOT</span>
            </footer>
</div>
</body>
</html>
