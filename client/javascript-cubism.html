<!DOCTYPE html>
<!-- Generated by Apache Maven Doxia at 2024-12-04 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="keywords" content="jmx, rest, json, http, agent, jmx-rest-bridge, java, jmx4perl, jsr-160, jmx-rest">
  <title>                  Jolokia &#x2013; Jolokia Cubism Demo                                            </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap">
  <style media="all">
    @import url("../css/reset.css");
    @import url("../css/text.css");
    @import url("../css/maven-theme-jolokia.css");
    @import url("../css/site.css");
  </style>
  <link rel="stylesheet" href="../css/style.css">
  <script data-cfasync="false">
    let host = "jolokia.org";
      if ((host === window.location.host) && (window.location.protocol !== "https:")) {
        window.location.protocol = "https";
      }
  </script>
  <script src="../js/prettify/prettify.js"></script>
  <script src="../js/d3.v2.min.js"></script>
  <script src="../js/jquery-1.7.2-min.js"></script>
  <script src="../js/jolokia.js"></script>
  <script src="../js/cubism.v1.min.js"></script>
  <script src="../js/jolokia-cubism.js"></script>
  <script src="../js/javascript-cubism.js"></script>
  <link rel="stylesheet" href="../css/print.css" media="print">
  <link rel="icon" type="image/png" href="../images/favicon.png">
  <meta name="Date-Creation-yyyymmdd" content="20241204" />
  <meta name="Date-Revision-yyyymmdd" content="20241204" />
  <meta http-equiv="Content-Language" content="en" />
  
</head>
<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="header-image"></div>
  </div>

  <!-- Top-Bar  -->
  <nav class="header">
      <div class="top_left"></div>
      <div class="top_link">
        <a href="../index.html">Home</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../download.html">Download</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../features.html">Features</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../documentation.html">Documentation</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../support.html">Support</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="https://ro14nd.de">Blog</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="../about.html">About</a>
    </div>
    <div class="top_sep"></div>
    </nav>

  <main>
    <nav class="menu">
            <div class="navibox">
          <div class="navihead">
             <h5>Jolokia</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../libraries.html" title="Libraries">Libraries</a>
            </li>
                  <li class="none">
                          <a href="../migration.html" title="Migration to 2.0">Migration to 2.0</a>
            </li>
                  <li class="none">
                          <a href="../features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="../support.html" title="Support">Support</a>
            </li>
                  <li class="none">
                          <a href="../license.html" title="License">License</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../documentation.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../concepts.html" title="Concepts">Concepts</a>
            </li>
                  <li class="none">
                          <a href="../tutorial.html" title="Tutorial">Tutorial</a>
            </li>
                  <li class="none">
                          <a href="../reference/html/index.html" title="Reference Manual">Reference Manual</a>
            </li>
                  <li class="none">
                          <a href="../talks.html" title="Talks and Screencasts">Talks and Screencasts</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Agents</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../agent.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../agent/war.html" title="Web Archive (war)">Web Archive (war)</a>
            </li>
                  <li class="none">
                          <a href="../agent/osgi.html" title="Osgi">Osgi</a>
            </li>
                  <li class="none">
                          <a href="../agent/jvm.html" title="JVM">JVM</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Clients</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="../client/java.html" title="Java">Java</a>
            </li>
                  <li class="none">
                          <a href="../client/javascript.html" title="JavaScript">JavaScript</a>
            </li>
                  <li class="none">
                          <a href="../client/perl.html" title="Perl">Perl</a>
            </li>
                  <li class="none">
                          <a href="../client/curl.html" title="Curl">Curl</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Project Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
    </div>
      </div>
      </nav>
    <div class="main">
      <!-- Page content -->
      <div class="sect1">
<h2 id="jolokia_cubism_integration">Jolokia-Cubism Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://square.github.com/cubism/" class="externalLink" target="_blank" rel="noopener">Cubism</a> is a
fine JavaScript library for plotting timeseries data based on
<a href="https://d3js.org/" class="externalLink" target="_blank" rel="noopener">d3.js</a>. It provides support for
various backend sources like
<a href="https://graphite.wikidot.com/" class="externalLink" target="_blank" rel="noopener">Graphite</a> or
<a href="https://square.github.com/cube/" class="externalLink" target="_blank" rel="noopener">Cube</a> and also for
Jolokia. It is easy to use and provides innovative chart types
like a
<a href="https://vis.berkeley.edu/papers/horizon/" class="externalLink" target="_blank" rel="noopener">horizon</a>
chart. The Jolokia integration polls the Jolokia agent
periodically and remembers the values locally. It uses the
<a href="../reference/html/manual/clients.html#js-poller">scheduling
facility</a> of the Jolokia JavaScript library by sending a
single bulk request for fetching the data for all charts and is
hence very efficient.</p>
</div>
<div class="paragraph">
<p>The following sections show some simple real time demos of
this integration. After that, some concepts are explained. The
full JavaScript source can be downloaded
<a href="../js/javascript-cubism.js">here</a>.</p>
</div>
<div class="sect2">
<h3 id="heapmemory">HeapMemory</h3>
<div class="paragraph">
<p>The following demo directly queries Jolokia&#8217;s
<a href="https://labs.consol.de/jenkins" class="externalLink" target="_blank" rel="noopener">CI</a> which
is a plain Tomcat 7. The memory charts show the heap memory
usage as a fraction of the maximum available heap. Note that
different colors indicate different value ranges in this
<a href="https://github.com/square/cubism/wiki/Horizon" class="externalLink" target="_blank" rel="noopener">horizon chart</a>. The activity of the two garbage collectors for
the young and old generation are shown below. Feel free to
trigger a garbage collection on your own by pressing the
button and look how the chart is changing.</p>
</div>
<div id="memory"></div>
<button style="margin-top: 10px; margin-left: 25px;" onclick="gc()">Trigger Garbage Collection</button>
</div>
<div class="sect2">
<h3 id="requests_per_10_seconds">Requests (per 10 seconds)</h3>
<div class="paragraph">
<p>The second demo visualizes the number of requests served by
this Tomcat instance. The requests are grouped by 10s, so
the values are the number of requests received in the last
10 seconds. The green charts show the requests for the
<a href="https://jolokia.org/jolokia" class="externalLink" target="_blank" rel="noopener">Jolokia agent</a> and the
href="<a href="https://labs.consol.de/jenkins" class="externalLink" target="_blank" rel="noopener">Jenkins CI server</a>. Since this demo queries the Jolokia
agent every second, the first chart should show up at least
10 request per 10 seconds. Finally the number of requests
served by all deployed servlets is drawn in blue.</p>
</div>
<div id="request"></div>
</div>
<div class="sect2">
<h3 id="examples">Examples</h3>
<div class="paragraph">
<p>Plotting the result of a single Jolokia request is simple
and follows the general pattern used by Cubism. You first
create a Jolokia source from the Cubism context and create
metrics from this source. When a metric is created, it
registers one or more Jolokia request for the
<a href="../reference/html/manual/clients.html#js-poller">Jolokia scheduler</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="c1">// Create a top-level Cubism Context</span>
<span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">cubism</span><span class="p">.</span><span class="nx">context</span><span class="p">();</span>

<span class="c1">// Create a source for Jolokia metrics pointing to the agent</span>
<span class="c1">// at 'https://jolokia.org/jolokia'</span>
<span class="kd">var</span> <span class="nx">jolokia</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">jolokia</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://jolokia.org/jolokia</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Create a metric for the absolute Heap memory usage</span>
<span class="kd">var</span> <span class="nx">memoryAbs</span> <span class="o">=</span> <span class="nx">jolokia</span><span class="p">.</span><span class="nx">metric</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">read</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">mbean</span><span class="p">:</span> <span class="dl">'</span><span class="s1">java.lang:type=Memory</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">attribute</span><span class="p">:</span> <span class="dl">'</span><span class="s1">HeapMemoryUsage</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">used</span><span class="dl">'</span>
    <span class="p">},</span> <span class="dl">"</span><span class="s2">HeapMemory Usage</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Use d3 to attach the metrics with a specific graph type</span>
<span class="c1">// ('horizon' in this case) to the document</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="dl">"</span><span class="s2">#charts</span><span class="dl">"</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">div</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">div</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">memoryAbs</span><span class="p">])</span>
        <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">horizon</span><span class="p">())</span>
<span class="p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example present an advanced concept if more
flexibility is required. When the first argument to
<code>jolokia.metric()</code> is a function, this function is
feed periodically with Jolokia response objects resulting from the
requests object given as second argument. The final
argument can be an options object, which in this case indicates
the label of the chart and the type to be a delta chart,
measuring only the increase rate for ten seconds.</p>
</div>
<div class="paragraph">
<p>This sample also shows how to use wildcard patterns in a read
request to fetch multiple values at once in a generic
fashion. Wildcard reading is explained in detail in the
<a href="../reference/html/manual/jolokia_protocol.html#read">reference manual</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">var</span> <span class="nx">allRequestsMetric</span> <span class="o">=</span> <span class="nx">jolokia</span><span class="p">.</span><span class="nx">metric</span><span class="p">(</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">requestCount</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">read</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">mbean</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Catalina:j2eeType=Servlet,*</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">attribute</span><span class="p">:</span> <span class="dl">"</span><span class="s2">requestCount</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">All Requests</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">delta</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="p">});</span></code></pre>
</div>
</div>
</div>
</div>
</div>
      <!-- /Page content -->
    </div>
  </main>

  <footer class="copyright">Copyright &#169;                   2024 Roland Hu&szlig;. 
          All Rights Reserved.      
                
                 <span id="publishDate">Last Published: 2024-12-04</span>
              &nbsp;| <span id="projectVersion">Version: 2.1.3-SNAPSHOT</span>
            </footer>
</div>
</body>
</html>
