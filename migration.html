<!DOCTYPE html>
<!-- Generated by Apache Maven Doxia at 2024-12-04 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="keywords" content="jmx, rest, json, http, agent, jmx-rest-bridge, java, jmx4perl, jsr-160, jmx-rest">
  <title>                                                    Jolokia &#x2013; Migration to 2.0          </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap">
  <style media="all">
    @import url("./css/reset.css");
    @import url("./css/text.css");
    @import url("./css/maven-theme-jolokia.css");
    @import url("./css/site.css");
  </style>
  <script data-cfasync="false">
    let host = "jolokia.org";
      if ((host === window.location.host) && (window.location.protocol !== "https:")) {
        window.location.protocol = "https";
      }
  </script>
  <script src="./js/prettify/prettify.js"></script>
  <link rel="stylesheet" href="./css/print.css" media="print">
  <link rel="icon" type="image/png" href="./images/favicon.png">
  <meta name="Date-Creation-yyyymmdd" content="20241204" />
  <meta name="Date-Revision-yyyymmdd" content="20241204" />
  <meta http-equiv="Content-Language" content="en" />
  
</head>
<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="header-image"></div>
  </div>

  <!-- Top-Bar  -->
  <nav class="header">
      <div class="top_left"></div>
      <div class="top_link">
        <a href="index.html">Home</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="download.html">Download</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="features.html">Features</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="documentation.html">Documentation</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="support.html">Support</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="https://ro14nd.de">Blog</a>
    </div>
    <div class="top_sep"></div>
      <div class="top_link">
        <a href="about.html">About</a>
    </div>
    <div class="top_sep"></div>
    </nav>

  <main>
    <nav class="menu">
            <div class="navibox">
          <div class="navihead">
             <h5>Jolokia</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="libraries.html" title="Libraries">Libraries</a>
            </li>
                  <li class="none">
            <strong>Migration to 2.0</strong>
          </li>
                  <li class="none">
                          <a href="features.html" title="Features">Features</a>
            </li>
                  <li class="none">
                          <a href="support.html" title="Support">Support</a>
            </li>
                  <li class="none">
                          <a href="license.html" title="License">License</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="documentation.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="concepts.html" title="Concepts">Concepts</a>
            </li>
                  <li class="none">
                          <a href="tutorial.html" title="Tutorial">Tutorial</a>
            </li>
                  <li class="none">
                          <a href="reference/html/index.html" title="Reference Manual">Reference Manual</a>
            </li>
                  <li class="none">
                          <a href="talks.html" title="Talks and Screencasts">Talks and Screencasts</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Agents</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="agent.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="agent/war.html" title="Web Archive (war)">Web Archive (war)</a>
            </li>
                  <li class="none">
                          <a href="agent/osgi.html" title="Osgi">Osgi</a>
            </li>
                  <li class="none">
                          <a href="agent/jvm.html" title="JVM">JVM</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Clients</h5>
            </div>    
            <div class="naviitems">
    <ul>
                  <li class="none">
                          <a href="client/java.html" title="Java">Java</a>
            </li>
                  <li class="none">
                          <a href="client/javascript.html" title="JavaScript">JavaScript</a>
            </li>
                  <li class="none">
                          <a href="client/perl.html" title="Perl">Perl</a>
            </li>
                  <li class="none">
                          <a href="client/curl.html" title="Curl">Curl</a>
            </li>
          </ul>
    </div>
      </div>
      <div class="navibox">
          <div class="navihead">
             <h5>Project Documentation</h5>
            </div>    
            <div class="naviitems">
    <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
    </div>
      </div>
      </nav>
    <div class="main">
      <!-- Page content -->
      <div class="sect1">
<h2 id="migration_to_2_x">Migration to 2.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jolokia 2.0 should be fully backward-compatible with versions 1.x at protocol level. This means that old <code>jolokia.js</code> library should work with Jolokia 2 as well.</p>
</div>
<div class="paragraph">
<p>This is true also from Jolokia Java client perspective and processing of JSON messages sent over HTTP.</p>
</div>
<div class="paragraph">
<p>However there are other aspects that need to be considered when moving from Jolokia 1 to Jolokia 2.</p>
</div>
<div class="sect2">
<h3 id="servlet_api_compatibility">Servlet API compatibility</h3>
<div class="paragraph">
<p><code>org.jolokia.server.core.http.AgentServlet</code> which is part of <code>org.jolokia:jolokia-server-core</code> library is now implementing Servlet API 5 from Jakarta EE 9 specification. In fact it should be compatible with any newer Jakarta EE specification (e.g., 10) and Servlet API (e.g., 6).</p>
</div>
<div class="paragraph">
<p>This concerns also the derived <code>org.jolokia.server.core.osgi.OsgiAgentServlet</code> from <code>org.jolokia:jolokia-agent-osgi</code> which now works with new <a href="https://docs.osgi.org/specification/osgi.cmpn/8.1.0/service.servlet.html" class="externalLink" target="_blank" rel="noopener">OSGi CMPN Whiteboard Specification for Jakarta™ Servlet</a> based on Jakarta EE 9+. This means that Jolokia 2.0 OSGi bundle won&#8217;t work with Karaf 4.4 which uses Jakarta EE specification based on <code>javax</code> packages.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/apache/felix-dev/tree/master/http" class="externalLink" target="_blank" rel="noopener">Felix HTTP</a> has PoC module based on Jetty 12 that implements two Servlet APIs (<code>javax</code> and <code>jakarta</code>) and at [current state] it should support Jolokia 2.</p>
</div>
<div class="paragraph">
<p>In <a href="https://github.com/ops4j/org.ops4j.pax.web" class="externalLink" target="_blank" rel="noopener">Pax Web</a> there&#8217;s work pending on Pax Web 10 which also should support old and new Servlet API packages.</p>
</div>
<div class="paragraph">
<p>Moving to JakartaEE 9+ impacted Jolokia&#8217;s WAR agents - these use <code>https://jakarta.ee/xml/ns/jakartaee</code> namespace in <code>WEB-INF/web.xml</code> and should work in these web application servers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://eclipse.dev/jetty/download.php" class="externalLink" target="_blank" rel="noopener">Jetty 11 and newer</a></p>
</li>
<li>
<p><a href="https://tomcat.apache.org/download-10.cgi" class="externalLink" target="_blank" rel="noopener">Tomcat 10 and newer</a></p>
</li>
<li>
<p><a href="https://github.com/undertow-io/undertow/" class="externalLink" target="_blank" rel="noopener">Undertow 2.3 and newer</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course all JakartaEE 9+ compliant servers are supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="javascript_support">Javascript support</h3>
<div class="paragraph">
<p>Jolokia 1.x includes <code>org.jolokia:jolokia-client-javascript</code> Maven module, which packages <code>jolokia.js</code>, <code>jolokia-simple.js</code> and other libraries.</p>
</div>
<div class="paragraph">
<p>In Jolokia 2, the same Maven module can be used in your Java application, but additionally, official <a href="https://www.npmjs.com/package/jolokia.js" class="externalLink" target="_blank" rel="noopener">NPM package</a> is available. You can install it with <code>npm i jolokia.js</code> or <code>yarn add jolokia.js</code>.</p>
</div>
<div class="paragraph">
<p>There are <a href="https://www.npmjs.com/search?q=jolokia" class="externalLink" target="_blank" rel="noopener">several other Jolokia NPM packages available</a>, so mind that <code>jolokia.js</code> is the official one.</p>
</div>
<div class="paragraph">
<p>The minimum supported JavaScript version is now ES5. For environments with ES3 and older JavaScript versions, keep using old versions of the JavaScript client provided with Jolokia 1.x.</p>
</div>
<div class="paragraph">
<p>Since it is based on ES5, <code>JSON2.js</code> is no longer required. You can also use it with a TypeScript project, as the client provides its type definitions with the package.</p>
</div>
</div>
<div class="sect2">
<h3 id="reorganized_modules">Reorganized modules</h3>
<div class="paragraph">
<p>Jolokia 2 modules are organized into extensible core module and pluggable services. More information can be found on <a href="libraries.html">Libraries page</a>.</p>
</div>
<div class="paragraph">
<p>Because important Jolokia functionality has been split across <em>server</em> and <em>service</em> modules, at least 3 modules are now needed to provide the same functionality which was provided by single <code>org.jolokia:jolokia-core</code> library from Jolokia 1.</p>
</div>
<div class="paragraph">
<p>These required modules are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.jolokia:jolokia-server-core</code> provides request processing framework, extensible request handling, configuration classes and <code>AgentServlet</code> (among others)</p>
</li>
<li>
<p><code>org.jolokia:jolokia-service-serializer</code> provides Java to JSON serialization services</p>
</li>
<li>
<p><code>org.jolokia:jolokia-service-jmx</code> provides <em>local request handler</em> and JMX command handlers (read, exec, search, &#8230;&#8203;) to handle JMX operation on locally reachable MBeans and MBeanServers</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="jolokia_jvm_agent_module">Jolokia JVM Agent module</h4>
<div class="paragraph">
<p>In order to have <em>one size fits all</em> solution, it&#8217;s enough to include one Jolokia dependency in your Maven project and Servlet API library of your choice (<code>jolokia-server-core</code> has a dependency on <code>jakarta.servlet:jakarta-servlet-api</code> in <code>provided</code> scope)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.jolokia<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jolokia-agent-jvm<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.1.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This brings in the following dependencies to your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+- org.jolokia:jolokia-agent-jvm:jar:2.1.2:compile
|  +- org.jolokia:jolokia-json:jar:2.1.2:compile
|  +- org.jolokia:jolokia-server-core:jar:2.1.2:compile
|  +- org.jolokia:jolokia-server-detector:jar:2.1.2:compile
|  +- org.jolokia:jolokia-service-serializer:jar:2.1.2:compile
|  +- org.jolokia:jolokia-service-jmx:jar:2.1.2:compile
|  +- org.jolokia:jolokia-service-discovery:jar:2.1.2:compile
|  +- org.jolokia:jolokia-service-history:jar:2.1.2:compile
|  +- org.jolokia:jolokia-service-jsr160:jar:2.1.2:compile
|  +- org.jolokia:jolokia-service-notif-pull:jar:2.1.2:compile
|  \- org.jolokia:jolokia-service-notif-sse:jar:2.1.2:compile
+- org.jolokia:jolokia-support-jmx:jar:2.1.2:compile</pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>org.jolokia:jolokia-agent-jvm</code> dependency is a safe bet, as all required libraries (except Servlet API, which is in <code>provided</code> scope, so should be also <em>provided</em> by you) are brought in.</p>
</div>
<div class="paragraph">
<p>There&#8217;s also a second <em>flavor</em> of <code>org.jolokia:jolokia-agent-jvm</code> with <code>javaagent</code> classifier (which is downloaded as <code>jolokia-agent-jvm-2.1.2-javaagent.jar</code> file) that shouldn&#8217;t be used as <em>normal</em> Maven dependency. Instead this version enbeds its dependencies. This version of JVM Agent is to be used specifically outside of Maven project - in container images or standalone applications using <code>-javaagent:/path/to/agent.jar</code> JVM argument.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="added_modules">Added modules</h3>
<div class="paragraph">
<p>Jolokia 2.1.0 has one important change - it finally drops one of its first dependencies, which was <code>com.googlecode.json-simple:json-simple</code> JSON parser library. Instead it uses the <a href="https://www.jflex.de/">JFlex lexer toolkit</a> and JSON grammar and provides own <code>org.jolokia:jolokia-json</code> JSON parser/serializer library. In brief tests (and with few related optimizations) it gets 2x performance boost comparing to previous library.</p>
</div>
<div class="paragraph">
<p>The API change is minimal - because what is generated based on the JSON grammar is only a <em>lexer</em>, Jolokia has full freedom to provide own parser/serializer. From user perspective it should be enought to rename code references from <code>org.json.simple</code> to <code>org.jolokia.json</code>. Other classes that were previously used by Jolokia and provided by <a href="https://code.google.com/archive/p/json-simple/" class="externalLink" target="_blank" rel="noopener">json-simple</a> library have the same names (except the package name).</p>
</div>
</div>
<div class="sect2">
<h3 id="removed_modules">Removed modules</h3>
<div class="ulist">
<ul>
<li>
<p><code>jolokia-roo:jolokia-roo</code> for <a href="https://spring.io/projects/spring-roo" class="externalLink" target="_blank" rel="noopener">Spring Roo</a> is no longer available. Spring Roo was kind of experiment before highly successful <a href="https://spring.io/projects/spring-boot" class="externalLink" target="_blank" rel="noopener">Spring Boot</a>.</p>
</li>
<li>
<p><code>org.jolokia:jolokia-osgi-bundle</code> (with embedded <a href="https://github.com/apache/felix-dev/tree/master/http" class="externalLink" target="_blank" rel="noopener">Felix HTTP</a>) is no longer available. Normal <code>org.jolokia:jolokia-agent-osgi</code> should be used with OSGi runtime supporting <a href="https://docs.osgi.org/specification/osgi.cmpn/8.1.0/service.servlet.html" class="externalLink" target="_blank" rel="noopener">OSGi CMPN Whiteboard Specification for Jakarta™ Servlet</a></p>
</li>
<li>
<p><code>org.jolokia:jolokia-mule</code> agent is no longer available, but because Jolokia 2 (and 1) simply provides servlet implementation, it can be used in any environment hosting a servlet container</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="changed_modules">Changed modules</h3>
<div class="ulist">
<ul>
<li>
<p><code>org.jolokia:jolokia-spring</code> library (<code>org.jolokia:jolokia-support-spring</code> in Jolokia 2) is no longer including <code>META-INF/spring/jolokia.xml</code> resource ready to be used with your Spring Framework XML DSL (using <code>&lt;import resource="classpath:META-INF/spring/jolokia.xml" /&gt;</code>). There are other options for Spring Framework and Spring Boot integration presented in reference manual.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuration_option_changes">Configuration option changes</h3>
<div class="ulist">
<ul>
<li>
<p><code>listenForHttpService</code> option is now deprecated and <code>registerWhiteboardServlet</code> should be used instead in OSGi environments. The reason is that Jolokia 2 switched from <a href="https://docs.osgi.org/specification/osgi.cmpn/7.0.0/service.http.html" class="externalLink" target="_blank" rel="noopener">OSGi CMPN Http Service</a> to <a href="https://docs.osgi.org/specification/osgi.cmpn/8.1.0/service.servlet.html" class="externalLink" target="_blank" rel="noopener">OSGi CMPN Whiteboard Specification for Jakarta™ Servlet</a>.</p>
</li>
<li>
<p><code>dispatcherClasses</code> option is removed. In Jolokia 1.x it was used to add <code>org.jolokia.service.jsr160.Jsr160RequestHandler</code> to a list of available request handlers. In Jolokia 2, this class is dicovered using new service extension model of Jolokia, when <code>jolokia-service-jsr160</code> is available on the CLASSPATH (or in <code>WEB-INF/lib</code> of the WAR, which is the case for <code>jolokia-agent-war</code>).</p>
</li>
<li>
<p>Jolokia checks some configuration values also from system properties and environment variables. For example <code>discoveryAgentUrl</code> option can be specified as <code>jolokia.discoveryAgentUrl</code> system property or <code>JOLOKIA_DISCOVERY_AGENT_URL</code> environment variable. However some options had different format of related system property. In Jolokia 1.x, <code>jsr160ProxyAllowedTargets</code> could be specified as <code>org.jolokia.jsr160ProxyAllowedTargets</code> system property. Now all system properties have <code>jolokia.</code> prefix only.</p>
</li>
<li>
<p><code>allowDnsReverseLookup</code> option defaults to <code>false</code> in Jolokia 2.</p>
</li>
<li>
<p><code>includeStackTrace</code> option defaults to <code>false</code> in Jolokia 2.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jolokia_mbean_changes">Jolokia MBean changes</h3>
<div class="paragraph">
<p>Jolokia 1 registers <code>jolokia:type=Config</code> which combines <em>history</em> and <em>debug</em> attributes and operations:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/jolokia1-mbeans.png" alt="Jolokia 1 jolokia:type=Config MBean"/>
</div>
</div>
<div class="paragraph">
<p>Jolokia 2 registers <code>jolokia:type=Config</code> with just <em>debug</em> attributes and operations, while <em>history</em> part is contained in separate <code>jolokia:type=History</code> MBean.</p>
</div>
<div class="paragraph">
<p>Also <code>agent=&lt;agentId&gt;</code> key is added to all Jolokia MBean names.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/jolokia2-mbeans.png" alt="Jolokia 2 MBeans"/>
</div>
</div>
</div>
<div class="sect2">
<h3 id="other_changes">Other changes</h3>
<div class="ulist">
<ul>
<li>
<p>For Spring support, in <code>jolokia-config.xsd</code>, references to SLF4J (enumerations, config options) are renamed from <code>sl4j</code> to <code>slf4j</code>. Also <code>log4j2</code> enum is used instead of <code>log4j</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
      <!-- /Page content -->
    </div>
  </main>

  <footer class="copyright">Copyright &#169;                   2024 Roland Hu&szlig;. 
          All Rights Reserved.      
                
                 <span id="publishDate">Last Published: 2024-12-04</span>
              &nbsp;| <span id="projectVersion">Version: 2.1.3-SNAPSHOT</span>
            </footer>
</div>
</body>
</html>
